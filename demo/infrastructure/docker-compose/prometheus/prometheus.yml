# Prometheus configuration for demo environment
# Scrapes metrics from OpenTelemetry Collector
# Supports native OTLP ingestion (Prometheus v3.0+)

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: demo
    cluster: local

# OTLP configuration for native OTLP receiver (Prometheus v3.0+)
otlp:
  # Promote resource attributes to labels
  promote_resource_attributes:
    - service.name
    - service.namespace
    - service.instance.id
  # Use NoTranslation to preserve original metric names (requires UTF-8)
  translation_strategy: NoTranslation

# Scrape configurations
scrape_configs:
  # Scrape Prometheus itself
  - job_name: prometheus
    static_configs:
      - targets: [localhost:9090]
        labels:
          service: prometheus

  # Scrape OpenTelemetry Collector metrics
  - job_name: otel-collector
    scrape_interval: 10s
    static_configs:
      - targets: [otel-collector:8888]
        labels:
          service: otel-collector
          component: collector

  # Scrape OpenTelemetry Collector Prometheus exporter
  - job_name: otel-metrics
    scrape_interval: 15s
    static_configs:
      - targets: [otel-collector:8889]
        labels:
          component: applications

# Storage configuration
storage:
  tsdb:
    # Out-of-order ingestion window for distributed collectors
    out_of_order_time_window: 30m
